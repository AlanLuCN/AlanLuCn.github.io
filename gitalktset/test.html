<!DOCTYPE html>
<!-- saved from url=(0061)https://wiyi.org/gitalk-anonymous-comment.html#implementation -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="google-site-verification" content="59REMt7Qo9qrDihgaI20hTBJHDbIpxkZok5XF25ZlJA"><title>给gitalk添加匿名评论功能 | Bigbyto</title>

<meta name="description" content="gitalk是一个基于github issue的评论系统，这个想法是非常具有创意的。不过一直以来这个项目都存在一些问题。  整个OAuth流程放在前端，暴露了client_id和client_secret  github权限粒度较高，用户授权时会把仓库所有的权限授权出去，容易被人恶意利用  获取access_to...">
<link rel="canonical" href="https://wiyi.org/gitalk-anonymous-comment.html"><link rel="alternate" type="application/rss+xml" title="Bigbyto" href="https://wiyi.org/feed.xml">
<!-- begin favicon --><link rel="apple-touch-icon" sizes="180x180" href="https://wiyi.org/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://wiyi.org/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://wiyi.org/assets/favicon-16x16.png"><link rel="manifest" href="https://wiyi.org/assets/site.webmanifest"><link rel="mask-icon" href="https://wiyi.org/assets/safari-pinned-tab.svg" color="#fc4d50"><link rel="shortcut icon" href="https://wiyi.org/assets/favicon.ico">

<meta name="msapplication-TileColor" content="#ffc40d"><meta name="msapplication-config" content="/assets/browserconfig.xml">

<meta name="theme-color" content="#ffffff">
<!-- end favicon --><link rel="stylesheet" href="./给gitalk添加匿名评论功能_files/main.css"><link rel="stylesheet" href="./给gitalk添加匿名评论功能_files/all.min.css"><style>
	textarea {
		-webkit-appearance: none;
	}
</style>
<script src="./给gitalk添加匿名评论功能_files/hm.js.下载"></script><script>(function() {
  window.isArray = function(val) {
    return Object.prototype.toString.call(val) === '[object Array]';
  };
  window.isString = function(val) {
    return typeof val === 'string';
  };

  window.decodeUrl = function(str) {
    return str ? decodeURIComponent(str.replace(/\+/g, '%20')) : '';
  };


  window.hasEvent = function(event) {
    return 'on'.concat(event) in window.document;
  };

  window.isOverallScroller = function(node) {
    return node === document.documentElement || node === document.body || node === window;
  };

  window.pageLoad = (function () {
    var loaded = false, cbs = [];
    window.addEventListener('load', function () {
      var i, cb; loaded = true;
      if (cbs.length > 0) {
        for (i = 0; i < cbs.length; i++) {
          cb = cbs[i]; cb();
        }
      }
    });
    return {
      then: function(cb) {
        cb && (loaded ? cb() : (cbs.push(cb)));
      }
    };
  })();
})();(function() {
  window.throttle = function(func, wait) {
    var args, result, thisArg, timeoutId, lastCalled = 0;

    function trailingCall() {
      lastCalled = new Date;
      timeoutId = null;
      result = func.apply(thisArg, args);
    }
    return function() {
      var now = new Date,
        remaining = wait - (now - lastCalled);

      args = arguments;
      thisArg = this;

      if (remaining <= 0) {
        clearTimeout(timeoutId);
        timeoutId = null;
        lastCalled = now;
        result = func.apply(thisArg, args);
      } else if (!timeoutId) {
        timeoutId = setTimeout(trailingCall, remaining);
      }
      return result;
    };
  };
})();(function() {
  var Set = (function() {
    var add = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (data[i] === item) {
          return;
        }
      }
      this.size ++;
      data.push(item);
      return data;
    };

    var Set = function(data) {
      this.size = 0;
      this._data = [];
      var i;
      if (data.length > 0) {
        for (i = 0; i < data.length; i++) {
          add.call(this, data[i]);
        }
      }
    };
    Set.prototype.add = add;
    Set.prototype.get = function(index) { return this._data[index]; };
    Set.prototype.has = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (this.get(i) === item) {
          return true;
        }
      }
      return false;
    };
    Set.prototype.is = function(map) {
      if (map._data.length !== this._data.length) { return false; }
      var i, j, flag, tData = this._data, mData = map._data;
      for (i = 0; i < tData.length; i++) {
        for (flag = false, j = 0; j < mData.length; j++) {
          if (tData[i] === mData[j]) {
            flag = true;
            break;
          }
        }
        if (!flag) { return false; }
      }
      return true;
    };
    Set.prototype.values = function() {
      return this._data;
    };
    return Set;
  })();

  window.Lazyload = (function(doc) {
    var queue = {js: [], css: []}, sources = {js: {}, css: {}}, context = this;
    var createNode = function(name, attrs) {
      var node = doc.createElement(name), attr;
      for (attr in attrs) {
        if (attrs.hasOwnProperty(attr)) {
          node.setAttribute(attr, attrs[attr]);
        }
      }
      return node;
    };
    var end = function(type, url) {
      var s, q, qi, cbs, i, j, cur, val, flag;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        s[url] = true;
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (cur.urls.has(url)) {
            qi = cur, val = qi.urls.values();
            qi && (cbs = qi.callbacks);
            for (flag = true, j = 0; j < val.length; j++) {
              cur = val[j];
              if (!s[cur]) {
                flag = false;
              }
            }
            if (flag && cbs && cbs.length > 0) {
              for (j = 0; j < cbs.length; j++) {
                cbs[j].call(context);
              }
              qi.load = true;
            }
          }
        }
      }
    };
    var load = function(type, urls, callback) {
      var s, q, qi, node, i, cur,
        _urls = typeof urls === 'string' ? new Set([urls]) : new Set(urls), val, url;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (_urls.is(cur.urls)) {
            qi = cur;
            break;
          }
        }
        val = _urls.values();
        if (qi) {
          callback && (qi.load || qi.callbacks.push(callback));
          callback && (qi.load && callback());
        } else {
          q.push({
            urls: _urls,
            callbacks: callback ? [callback] : [],
            load: false
          });
          for (i = 0; i < val.length; i++) {
            node = null, url = val[i];
            if (s[url] === undefined) {
              (type === 'js' ) && (node = createNode('script', { src: url }));
              (type === 'css') && (node = createNode('link', { rel: 'stylesheet', href: url }));
              if (node) {
                node.onload = (function(type, url) {
                  return function() {
                    end(type, url);
                  };
                })(type, url);
                (doc.head || doc.body).appendChild(node);
                s[url] = false;
              }
            }
          }
        }
      }
    };
    return {
      js: function(url, callback) {
        load('js', url, callback);
      },
      css: function(url, callback) {
        load('css', url, callback);
      }
    };
  })(this.document);
})();</script><script>
  (function() {
    var TEXT_VARIABLES = {
      sources: {
        font_awesome: 'https://cdn.staticfile.org/font-awesome/5.14.0/css/all.min.css',
        jquery: 'https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js',
        leancloud_js_sdk: '//cdn1.lncld.net/static/js/3.4.1/av-min.js',
        chart: 'https://cdn.bootcss.com/Chart.js/2.7.1/Chart.bundle.min.js',
        gitalk: {
          js: 'https://bigbyto.gitee.io/assets/js/gitalk/v1.6.8/gitalk.min.js',
          css: 'https://bigbyto.gitee.io/assets/js/gitalk/v1.6.8/gitalk.css'
        },
        mathjax: 'https://cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML',
        mermaid: 'https://cdn.bootcss.com/mermaid/7.1.2/mermaid.min.js'
      },
      site: {
        toc: {
          selectors: 'h1,h2,h3'
        }
      },
      paths: {
        search_js: '/assets/search.js'
      }
    };
    window.TEXT_VARIABLES = TEXT_VARIABLES;
  })();
</script><script src="./给gitalk添加匿名评论功能_files/jquery.min.js.下载"></script><link rel="stylesheet" href="./给gitalk添加匿名评论功能_files/gitalk.css"><script src="./给gitalk添加匿名评论功能_files/gitalk.min.js.下载"></script><script src="./给gitalk添加匿名评论功能_files/search.js.下载"></script><script>(async()=> {const internalUrls = {"zanshang":"chrome-extension://ooeibbihiflcgepabgfaicmipchncnhl/zanshang.png"};const manifest = {"background":{"page":"background.html"},"browser_action":{"default_title":"bilibili哔哩哔哩下载助手"},"content_scripts":[{"all_frames":true,"js":["lib.js"],"matches":["http://*/*","https://*/*"]},{"all_frames":false,"js":["flv-helper.js","cs.js"],"matches":["http://*/*","https://*/*"]},{"js":["jquery.js","content.js"],"matches":["http://*/*","https://*/*"],"run_at":"document_end"}],"content_security_policy":"script-src 'self'; object-src 'self'","description":"bilibili B站 哔哩哔哩下载助手 帮你下载版权受限（能看不能缓存）的 番剧 视频","icons":{"16":"icon.png","48":"icon.png","128":"icon.png"},"key":"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAod+6yw1YFY3ADiHeozAlkm8xJXIc87DwSqx4ELYkuKJT90kZUu0IXhDZG87qUjkf9OT15ZtLLm9W1D/x/yWvraCPLKpnKuaGWWryTimFq5v9pqOUDkvYMal+D3RiIIV2rELxofPpCUHouoA+VucIIM+jektfGLfa+fYeIwMjC+qZzY4ypOlHab5QlRMzyswbTKof7uLvRP+pEbz2D8sHBYRobfRBx8JB93kJOk67Tolxo1dwRfw1yEC7FLn+pgg78UgtCXwIv0fpqnPeXNNci3iPF1/tNWcwiqFd61HsOoSghWKaxyX6L2KWSTQYq13pdulpWyrLqGI0j87B0ql0gQIDAQAB","manifest_version":2,"name":"bilibili哔哩哔哩下载助手","offline_enabled":true,"permissions":["storage","http://*/*","tabs","webRequest","webRequestBlocking","browsingData","*://*/*","unlimitedStorage","https://*/*","contextMenus","<all_urls>"],"update_url":"https://edge.microsoft.com/extensionwebstorebase/v1/crx","version":"2.1.6","web_accessible_resources":["*.*","**/*.*"]};const e=()=>"www.bilibili.com"===location.hostname||"bilibili.com"===location.hostname;if(!e())return;const t=-1!==window.navigator.userAgent.indexOf("Edg/"),n=()=>/\/video\/(av|bv)[0-9a-zA-Z]+/i.test(window.location.pathname),i=()=>/\/bangumi\/play\/\S+/i.test(window.location.pathname);if(!n()&&!i())return;class a extends DataView{getUint24(e,t){if(t)throw"littleEndian int24 not implemented";return 16777215&this.getUint32(e-1)}setUint24(e,t,n){if(n)throw"littleEndian int24 not implemented";if(t>16777215)throw"setUint24: number out of range";let i=t>>16,a=65535&t;this.setUint8(e,i),this.setUint16(e+1,a)}indexOf(e,t=0,n=this.byteLength-e.length+1){if(e.charCodeAt){for(let i=t;i<n;i++){if(this.getUint8(i)!=e.charCodeAt(0))continue;let t=1;for(let n=0;n<e.length;n++)if(this.getUint8(i+n)!=e.charCodeAt(n)){t=0;break}if(t)return i}return-1}for(let i=t;i<n;i++){if(this.getUint8(i)!=e[0])continue;let t=1;for(let n=0;n<e.length;n++)if(this.getUint8(i+n)!=e[n]){t=0;break}if(t)return i}return-1}}class o{constructor(e,t=0){this.tagHeader=new a(e.buffer,e.byteOffset+t,11),this.tagData=new a(e.buffer,e.byteOffset+t+11,this.dataSize),this.previousSize=new a(e.buffer,e.byteOffset+t+11+this.dataSize,4)}get tagType(){return this.tagHeader.getUint8(0)}get dataSize(){return this.tagHeader.getUint24(1)}get timestamp(){return this.tagHeader.getUint24(4)}get timestampExtension(){return this.tagHeader.getUint8(7)}get streamID(){return this.tagHeader.getUint24(8)}stripKeyframesScriptData(){let e;if(18!=this.tagType)throw"can not strip non-scriptdata's keyframes";-1!=(e=this.tagData.indexOf("hasKeyframes"))&&this.tagData.setUint8(e+"hasKeyframes".length,0)}getDuration(){if(18!=this.tagType)throw"can not find non-scriptdata's duration";let e=this.tagData.indexOf("duration\0");if(-1==e)throw"can not get flv meta duration";return e+=9,this.tagData.getFloat64(e)}getDurationAndView(){if(18!=this.tagType)throw"can not find non-scriptdata's duration";let e=this.tagData.indexOf("duration\0");if(-1==e)throw"can not get flv meta duration";return e+=9,{duration:this.tagData.getFloat64(e),durationDataView:new a(this.tagData.buffer,this.tagData.byteOffset+e,8)}}getCombinedTimestamp(){return this.timestampExtension<<24|this.timestamp}setCombinedTimestamp(e){if(e<0)throw"timestamp < 0";this.tagHeader.setUint8(7,e>>24),this.tagHeader.setUint24(4,16777215&e)}}class s{constructor(e){if(0!=e.indexOf("FLV",0,1))throw"Invalid FLV header";this.header=new a(e.buffer,e.byteOffset,9),this.firstPreviousTagSize=new a(e.buffer,e.byteOffset+9,4),this.tags=[];let t=this.headerLength+4;for(;t<e.byteLength;){let n=new o(e,t);t+=11+n.dataSize+4,this.tags.push(n)}if(t!=e.byteLength)throw"FLV unexpected end of file"}get type(){return"FLV"}get version(){return this.header.getUint8(3)}get typeFlag(){return this.header.getUint8(4)}get headerLength(){return this.header.getUint32(5)}static merge(e){if(e.length<1)throw"Usage: FLV.merge([flvs])";let t,n=[],i=[0,0],a=[0,0],o=0;n.push(e[0].header),n.push(e[0].firstPreviousTagSize);for(let s of e){let r=1e3*o;i[0]=a[0],i[1]=a[1],r=Math.max(r,i[0],i[1]);let l=0;for(let i of s.tags)18!=i.tagType||l?8!=i.tagType&&9!=i.tagType||(a[i.tagType-8]=r+i.getCombinedTimestamp(),i.setCombinedTimestamp(a[i.tagType-8]),n.push(i.tagHeader),n.push(i.tagData),n.push(i.previousSize)):(o+=i.getDuration(),l=1,s==e[0]&&(({duration:o,durationDataView:t}=i.getDurationAndView()),i.stripKeyframesScriptData(),n.push(i.tagHeader),n.push(i.tagData),n.push(i.previousSize)))}return t.setFloat64(0,o),new Blob(n)}static async mergeBlobs(e){if(e.length<1)throw"Usage: FLV.mergeBlobs([blobs])";let t,n=[],i=[0,0],o=[0,0],r=0;for(let l of e){let d=1e3*r;i[0]=o[0],i[1]=o[1],d=Math.max(d,i[0],i[1]);let c=0,g=await new Promise((e,t)=>{let n=new FileReader;n.onload=(()=>e(new s(new a(n.result)))),n.readAsArrayBuffer(l),n.onerror=t}),p=[];for(let i of g.tags)18!=i.tagType||c?8!=i.tagType&&9!=i.tagType||(o[i.tagType-8]=d+i.getCombinedTimestamp(),i.setCombinedTimestamp(o[i.tagType-8]),p.push(i.tagHeader,i.tagData,i.previousSize)):(r+=i.getDuration(),c=1,l==e[0]&&(n.push(g.header,g.firstPreviousTagSize),({duration:r,durationDataView:t}=i.getDurationAndView()),i.stripKeyframesScriptData(),n.push(i.tagHeader),n.push(i.tagData),n.push(i.previousSize)));n.push(new Blob(p))}return t.setFloat64(0,r),new Blob(n)}}const r=e=>new Promise(t=>{let n=0,i=setInterval(()=>{n++;const a=document.querySelector(e);(a||n>10)&&(clearInterval(i),i=null,t(a))},500)}),l={credentials:"include"},d=()=>Promise.resolve({code:-1,message:"获取下载地址失败，可能是临时性的网络问题，可以尝试清除浏览器cookies和缓存后重试，如多次重试仍然报错，请通过邮箱或者QQ群反馈给我，谢谢"}),c=e=>{if(!e.durl)return-10403===e.code?(e.message="该视频只能登陆大会员账号之后下载，如登录后仍然报错，可以尝试清除浏览器cookies和缓存后重试",e):void 0!==e.code?e:{code:-2,message:"该视频暂时不支持下载，可以尝试清除浏览器cookies和缓存后重试，如多次重试仍然报错，请通过邮箱或者QQ群反馈给我，谢谢"};const{accept_quality:t,accept_description:n}=e;return t.forEach((e,t)=>{g[e]=n[t]}),{code:0,durls:e.durl.map(e=>{const t=new URL(e.url);return t.protocol=window.location.protocol,{url:t.href,size:e.size}}),qualityDescription:g[e.quality]}},g={120:"超清4K",112:"高清1080P+",80:"高清1080P",74:"高清720P60",64:"高清720P",48:"高清720P",32:"清晰480P",16:"流畅360P"},p=()=>"normal"!==localStorage.bilibili_helper_download_mode,h=()=>"off"!==localStorage.bilibili_helper_merge_mode,m=()=>"hide"===localStorage.bilibili_helper_show,u=e=>{const t=1073741824,n=1048576;return e>=t?`${(e/t).toFixed(2)}GB`:e>=n?`${(e/n).toFixed(2)}MB`:e>=1024?`${(e/1024).toFixed(2)}KB`:e+"B"},f=(e,t,n,i)=>0!==n?`<strong>${i}</strong>`:`<strong>${e}</strong> 的下载地址(共${t.length}个分段)：`,b=(e,t,n,i)=>{if(0!==n)return"";if(!p())return e.map((e,n)=>`\n        <li><a title="${t}_分段${n+1}" download href="${e.url}">分段${n+1}</a><span class="size">(${u(e.size)})</span></li>\n      `).join("");if(p()&&!h())return e.map((e,n)=>{const i=encodeURIComponent(JSON.stringify(e));return`\n          <li><a title="${t}_分段${n+1}" mode="advanced" merge="off" href="#nogo" durl="${i}">分段${n+1}</a><span class="size">(${u(e.size)})</span><span durl="${i}" class="progress"></span></li>\n        `}).join("");if(p()&&h()){const n=encodeURIComponent(JSON.stringify(e));let i=0;return e.forEach(e=>i+=e.size),`<li><a title="${t}" durls="${n}" mode="advanced" merge="on" href="#nogo">合并下载</a><span class="size">(共${u(i)})</span><ul style="margin-top: 8px;" durls="${n}" class="progress"></ul></li>`}},y=({code:e,title:n,durls:i,message:a,loading:o})=>{let s=document.getElementById("bilibili-helper-host"),r=null;const l=' <svg style="vertical-align: middle" width="50px" height="50px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="lds-pacman"><g ng-attr-style="display:{{config.showBean}}" style="display:block"><circle cx="62.0973" cy="50" r="4" ng-attr-fill="{{config.c2}}" fill="#00a1d6"><animate attributeName="cx" calcMode="linear" values="95;35" keyTimes="0;1" dur="1" begin="-0.67s" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" calcMode="linear" values="0;1;1" keyTimes="0;0.2;1" dur="1" begin="-0.67s" repeatCount="indefinite"></animate></circle><circle cx="82.4973" cy="50" r="4" ng-attr-fill="{{config.c2}}" fill="#00a1d6"><animate attributeName="cx" calcMode="linear" values="95;35" keyTimes="0;1" dur="1" begin="-0.33s" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" calcMode="linear" values="0;1;1" keyTimes="0;0.2;1" dur="1" begin="-0.33s" repeatCount="indefinite"></animate></circle><circle cx="42.2973" cy="50" r="4" ng-attr-fill="{{config.c2}}" fill="#00a1d6"><animate attributeName="cx" calcMode="linear" values="95;35" keyTimes="0;1" dur="1" begin="0s" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" calcMode="linear" values="0;1;1" keyTimes="0;0.2;1" dur="1" begin="0s" repeatCount="indefinite"></animate></circle></g><g ng-attr-transform="translate({{config.showBeanOffset}} 0)" transform="translate(-15 0)"><path d="M50 50L20 50A30 30 0 0 0 80 50Z" ng-attr-fill="{{config.c1}}" fill="#f45a8d" transform="rotate(10.946 50 50)"><animateTransform attributeName="transform" type="rotate" calcMode="linear" values="0 50 50;45 50 50;0 50 50" keyTimes="0;0.5;1" dur="1s" begin="0s" repeatCount="indefinite"></animateTransform></path><path d="M50 50L20 50A30 30 0 0 1 80 50Z" ng-attr-fill="{{config.c1}}" fill="#f45a8d" transform="rotate(-10.946 50 50)"><animateTransform attributeName="transform" type="rotate" calcMode="linear" values="0 50 50;-45 50 50;0 50 50" keyTimes="0;0.5;1" dur="1s" begin="0s" repeatCount="indefinite"></animateTransform></path></g></svg>';s?((r=s.shadowRoot).getElementById("title").innerHTML=o?"加载中"+l:f(n,i,e,a),r.getElementById("durls").innerHTML=o?"":b(i,n,e)):((s=document.createElement("bilibili-helper-host")).id="bilibili-helper-host",s.style.cssText=`display:block;overflow:auto;position:fixed;z-index:${Number.MAX_SAFE_INTEGER};bottom:0;left:0;right:0;max-height:50%;width:100%;background: #fff;border-top: 1px solid #ccc;box-shadow: rgba(0, 0, 0, 0.2) 0 -5px 10px;`,m()?s.classList.add("hide"):s.classList.remove("hide"),s.innerHTML="<style>\n        #bilibili-helper-host.hide{\n          width:auto!important;\n          left:auto!important;\n          background:transparent!important;\n          border:0 none!important;\n          border-radius: 6px 0 0 0;\n          box-shadow: rgba(0, 0, 0, 0.2) -5px -5px 10px!important;\n        }\n        .player-fullscreen-fix #bilibili-helper-host {\n          z-index: 99999!important;\n        }\n      </style>",document.body.appendChild(s),(r=s.attachShadow({mode:"open"})).innerHTML=`\n        <style>\n          p, a, div, span, li, i, b, strong, input, button, label {\n            font-size: inherit;\n          }\n          li {\n            margin-bottom: 5px;\n          }\n          p {\n            margin: 0;\n            line-height: 1.5;\n          }\n          h1 {\n            font-size: 20px;\n            font-weight: bold;\n            margin-bottom: 20px;\n          }\n          h3 {\n            font-size: 16px;\n            margin: 1em 0;\n          }\n          #title {\n            font-size: 16px;\n            font-weight: normal;\n          }\n          #content {\n            display: flex;\n            width: 100%;\n            font-size: 14px;\n            position: relative;\n          }\n          a {\n            color: #00a1d6 !important;\n            text-decoration: none;\n          }\n          a:hover {\n            text-decoration: underline;\n          }\n          a.disabled {\n            color: #666!important;\n          }\n          a.disabled:hover {\n            text-decoration: none;\n            cursor: not-allowed;\n          }\n          #side-bar {\n            flex: 3;\n            padding: 20px;\n            border-right: 1px solid #ccc;\n            margin-right: -1px;\n          }\n          #main {\n            flex: 7;\n            padding: 20px;\n            border-left: 1px solid #ccc;\n          }\n          #notice-frame {\n            width: 100%;\n            padding: 0;\n          }\n          .donate {\n            border-top: 1px solid #ccc;\n            padding-top: 10px;\n          }\n          #zanshang {\n            width: 80%;\n          }\n          .setting-item {\n            margin-bottom: 8px;\n          }\n          .setting-item .label {\n            font-weight: bold;\n            width: 6em;\n            display: inline-block;\n            text-align: right;\n          }\n          .desc {\n            padding-left: 6em;\n          }\n          #actions {\n            position: absolute;\n            right: 0;\n            top: 0;\n          }\n          .btn-large {\n            border: 0 none;\n            background: #f45a8d;\n            border-radius: 6px;\n            color: #fff;\n            padding: 10px 20px;\n          }\n          #toggle {\n            border-radius: 0 0 0 6px;\n            outline: none;\n            cursor: pointer;\n          }\n          .hide #side-bar {\n            display: none;\n          }\n          .hide #main {\n            display: none;\n          }\n          .hide #toggle {\n            border-radius: 6px 0 0 0;\n          }\n          .hide #actions {\n            position: static;\n          }\n      \n          a.btn {\n            border: 0 none;\n            background: #f45a8d;\n            text-decoration: none !important;\n            color: #fff !important;\n            border-radius: 3px;\n            padding: 5px 10px;\n            display: inline-block;\n          }\n          .settings {\n            border-left: 5px solid #ccc;\n            background: #eee;\n            padding: 16px 16px 8px 0;\n          }\n          .size {\n            margin: 0 5px;\n          }\n        </style>\n        <div id="content" ${m()?'class="hide"':""}>\n          <div id="side-bar">\n            <div class="notice">\n              <iframe id="notice-frame" frameborder="0"></iframe>\n            </div>\n            \x3c!--<div class="support">TODO 支持区域</div>--\x3e\n                   </div>\n          <div id="main">\n            <h1 style="margin-top: 0;">bilibili哔哩哔哩下载助手</h1>\n                    <div class="settings">\n              <div class="setting-item">\n                <span class="label">清晰度：</span>\n                <span>请在页面中B站自己的播放器内切换清晰度</span>\n              </div>\n              <div class="setting-item">\n                <span class="label">下载模式：</span>\n                <label><input id="setting-download-mode-advanced" checked name="setting-download-mode" type="radio"/> 高级</label>\n                <label><input id="setting-download-mode-normal" name="setting-download-mode" type="radio"/> 兼容</label>\n                <p class="desc">高级模式支持自动重命名和合并下载，但会占用非常大的系统运行内存<br/>兼容模式直接使用浏览器的默认下载，资源占用很小，但不支持自动重命名和合并下载</p>\n                <p class="desc">建议系统运行内存小于16G的用户以及合并下载经常卡住的用户使用兼容模式，下载后可以点<a href="http://csser.top/bilibili/merge.html" target="_blank">这里</a>尝试手动合并</p>\n              </div>\n              <div class="setting-item" id="setting-advanced">\n                <span class="label">合并下载：</span>\n                <label><input id="setting-merge-on" checked name="setting-merge" type="radio"> 开</label>\n                <label><input id="setting-merge-off" name="setting-merge" type="radio"> 关</label>\n                <p class="desc">高级模式下载过程中请<strong style="color: red;">不要</strong>刷新或关闭页面，也<strong style="color: red;">不要</strong>切换分集和清晰度</p>\n              </div>\n            </div>\n            <h3 id="title">${o?"加载中"+l:f(n,i,e,a)}</h3>\n            <ul id="durls">\n              ${o?"":b(i,n,e)}\n            </ul>\n            <div class="beg">\n              <p style="${t?"display:none":""}">\n                            </p>\n            </div>\n          </div>\n          <div id="actions">\n            <button id="toggle" class="btn-large">${m()?"打开bilibili哔哩哔哩下载助手":"收起"}</button>\n          </div>\n        </div>\n      `,(e=>{const t=e.getElementById("setting-download-mode-advanced"),n=e.getElementById("setting-download-mode-normal"),i=e.getElementById("setting-merge-on"),a=e.getElementById("setting-merge-off"),o=e.getElementById("setting-advanced"),s=e.getElementById("durls"),r=e.getElementById("toggle"),l=e.getElementById("actions"),d=e.getElementById("content"),c=document.getElementById("bilibili-helper-host"),g=()=>{t.disabled=!0,n.disabled=!0,i.disabled=!0,a.disabled=!0},u=()=>{t.disabled=!1,n.disabled=!1,i.disabled=!1,a.disabled=!1};p()?(t.checked=!0,n.checked=!1,o.style.display="block"):(t.checked=!1,n.checked=!0,o.style.display="none"),h()?(i.checked=!0,a.checked=!1):(i.checked=!1,a.checked=!0);const f=()=>{e.buildDownloadLinks()};t.addEventListener("change",()=>{t.checked?(localStorage.bilibili_helper_download_mode="advanced",o.style.display="block"):(localStorage.bilibili_helper_download_mode="normal",o.style.display="none"),f()}),n.addEventListener("change",()=>{n.checked?(localStorage.bilibili_helper_download_mode="normal",o.style.display="none"):(localStorage.bilibili_helper_download_mode="advanced",o.style.display="block"),f()}),i.addEventListener("change",()=>{localStorage.bilibili_helper_merge_mode=i.checked?"on":"off",f()}),a.addEventListener("change",()=>{localStorage.bilibili_helper_merge_mode=a.checked?"off":"on",f()}),s.addEventListener("click",t=>{const n=t.target;if("a"===n.tagName.toLowerCase()&&"advanced"===n.getAttribute("mode")){if(t.preventDefault(),t.stopPropagation(),n.classList.contains("disabled"))return;let i=null;const a=n.getAttribute("title");"on"===n.getAttribute("merge")?(i=e.querySelector(`ul[durls="${n.getAttribute("durls")}"]`),g(),_(n,JSON.parse(decodeURIComponent(n.getAttribute("durls"))),a,i).then(u)):(i=e.querySelector(`span[durl="${n.getAttribute("durl")}"]`),g(),x(n,JSON.parse(decodeURIComponent(n.getAttribute("durl"))),a,i).then(u))}}),r.addEventListener("click",()=>{m()?(localStorage.bilibili_helper_show="show",d.classList.remove("hide"),r.innerHTML="收起",c.classList.remove("hide"),l.style.top="0",e.getElementById("notice-frame").contentWindow.postMessage({action:"getHeight"},"https://csser.top")):(localStorage.bilibili_helper_show="hide",d.classList.add("hide"),c.classList.add("hide"),r.innerHTML="打开bilibili哔哩哔哩下载助手",l.style.top="0")}),c.addEventListener("scroll",()=>{l.style.top=c.scrollTop+"px"})})(r),(e=>{const t=e.getElementById("notice-frame");t.onload=(()=>{t.contentWindow.postMessage({action:"getHeight"},"https://csser.top"),t.contentWindow.postMessage({action:"setVersion",version:{name:manifest.version,code:parseInt(manifest.version.replace(/\./g,""),10)}},"https://csser.top"),t.contentWindow.postMessage({action:"setTheme",theme:"null"},"https://csser.top")}),window.addEventListener("message",e=>{if("https://csser.top"===e.origin&&e.data&&"reportHeight"===e.data.action&&(t.style.height=e.data.height+10+"px"),"https://csser.top"===e.origin&&e.data&&"showBilibilihelperindooorsmanNoticeDialog"===e.data.action){const t=e.data.notices;t&&t.length>0&&t.forEach(e=>{})}}),t.src=``,window.addEventListener("resize",()=>{t.contentWindow.postMessage({action:"getHeight"},"https://csser.top")})})(r)),r.buildDownloadLinks=(()=>{r.getElementById("durls").innerHTML=b(i,n,e)})},w=(e,t)=>{const n=new Blob([e],{type:"application/octet-stream"}),i=document.createElement("a");i.setAttribute("href",URL.createObjectURL(n)),i.setAttribute("download",t),i.setAttribute("style","position:absolute;top:-9999px;"),document.body.appendChild(i);const a=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});i.dispatchEvent(a),setTimeout(()=>{document.body.removeChild(i)},1e3)},v=(e,t,n)=>{let i=null;return fetch(e).then(e=>{const a=e.headers.get("content-length"),o=t||parseInt(a,10);let s=0;return i=setInterval(()=>{n(s,o)},1e3),new Response(new ReadableStream({start(t){const n=e.body.getReader(),i=()=>{n.read().then(({done:e,value:n})=>{e?t.close():(s+=n.byteLength,t.enqueue(n),i())}).catch(e=>{t.error(e)})};i()}}))}).then(e=>e.blob()).finally(()=>{i&&clearInterval(i)})},x=(e,{url:t,size:n},i,a)=>(e.classList.add("disabled"),v(t,n,(e,t)=>{const n=Math.ceil(e/t*100);a.innerHTML=` 正在下载 - ${e}/${t} - ${n}%`}).then(e=>{a.innerHTML=" 已下载完成";const n=new URL(t).pathname.toLowerCase().match(/\.[a-z0-9]+?$/)[0];w(e,i+n)}).finally(()=>{e.classList.remove("disabled")})),_=(e,t,n,i)=>{if(1===t.length)return x(e,t[0],n,i);e.classList.add("disabled");const a=t.map(({url:e,size:t},n)=>{const a=document.createElement("li");return a.innerHTML=`分段${n+1} (${u(t)}) 正在下载`,i.appendChild(a),v(e,t,(e,i)=>{const o=Math.ceil(e/i*100);a.innerHTML=`分段${n+1} (${u(t)}) 正在下载 - ${e}/${i} - ${o}%`}).then(e=>(a.innerHTML=`分段${n+1} (${u(t)}) 已下载完成，等待合并`,e))});return Promise.all(a).then(async e=>{const t=await s.mergeBlobs(Array.from(e));w(t,n+".flv"),i.innerHTML="已完成"}).finally(()=>{e.classList.remove("disabled")})},$=async()=>{if(!e())return;y({loading:!0});const t=await(()=>fetch(window.location.href,l).then(e=>e.text()).then(e=>{const t=e.match(/<script>window.__INITIAL_STATE__=(.+?)<\/script>/);return t&&t[1]?JSON.parse(t[1].replace(";(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());","")):{code:-2,message:"获取视频信息失败，可以尝试清除浏览器cookies和缓存后重试，如多次重试仍然报错，请通过邮箱或QQ群反馈给我，谢谢"}}).catch(()=>d()))();if(t.code)return y(t);let a=localStorage.bilibili_player_settings&&+JSON.parse(localStorage.bilibili_player_settings).setting_config.defquality||120;if(n()){const e=t.videoData.bvid||t.videoData.aid;let n,i,o=t.videoData.cid;if(t.videoData.pages.length>1){const e=location.search.match(/p=(\d+)/);let a=t.videoData.pages[0];e&&e[1]&&(a=t.videoData.pages.find(t=>""+t.page==""+e[1])),n=a.page,i=a.part,o=a.cid}const{code:s,durls:r,qualityDescription:g,message:p}=await((e,t,n=120)=>{const i=e.toLowerCase().startsWith("bv");return fetch(`//api.bilibili.com/x/player/playurl?cid=${t}&${i?"bvid":"avid"}=${e}&otype=json&qn=${n}`,l).then(e=>e.json()).then(e=>0!==e.code?c(e):c(e.data)).catch(()=>d())})(e,o,a);if(0===s){let e=`[${g}] ${t.videoData.title}`;n&&i&&(e=`[${g}] ${t.videoData.title}_P${n}_${i}`),y({code:s,title:e,durls:r,message:p})}else y({code:s,message:p})}if(i()){const e=t.epList;let n=-1===t.epId?e[e.length-1].ep_id:t.epId,i=e.find(e=>n===e.ep_id);const o=await r(".episode-item.on"),s=await r(".ep-item.cursor");if(o||s){const t=o||s,a=t.parentElement;let l=Array.from(a.querySelectorAll("li")).findIndex(e=>e===t);const d=await r("#eplist_module .ep-list-progress");d&&(l=+d.textContent.match(/(\d+)\/\d+/)[1]-1),i=e[l],n=i.ep_id||i.id}const{code:g,durls:p,qualityDescription:h,message:m}=await((e,t=120)=>{return fetch(`//api.bilibili.com/pgc/player/web/playurl/?ep_id=${e}&qn=${t}&bsource=`,l).then(e=>e.json()).then(e=>0!==e.code?c(e):c(e.result)).catch(()=>d())})(n,a);if(0===g){const e=`[${h}] ${t.mediaInfo.title}_${i.index||i.title}_${i.index_title||i.longTitle}`;y({code:g,title:e,durls:p,message:m})}else y({code:g,message:m})}};$();let L=""+window.location.href,T=""+localStorage.bilibili_player_settings;setInterval(()=>{const e=window.location.href,t=localStorage.bilibili_player_settings;if(L!==e&&(L=e,$()),T!==t)try{if(JSON.parse(t).setting_config.defquality===JSON.parse(T).setting_config.defquality)return;T=t,$()}catch(e){}},1e3)})();</script></head>
  <body>
    <div class="root" data-is-touch="false">
      <div class="layout--page clearfix js-page-root"><div class="page__main js-page-main has-aside"><div class="page__main-inner">
    <div></div><div class="page__content"><div class="main"><div class="col-aside js-col-aside"><aside class="page__aside js-page-aside fixed" style="left: 0px; top: 0px;"><div class="toc-aside js-toc-root"><ul class="toc"><li class="toc-h3 active"><a href="https://wiyi.org/gitalk-anonymous-comment.html#implementation">Implementation</a></li><li class="toc-h3"><a href="https://wiyi.org/gitalk-anonymous-comment.html#%E6%80%BB%E7%BB%93">总结</a></li><li class="toc-h3"><a href="https://wiyi.org/gitalk-anonymous-comment.html#%E4%BB%93%E5%BA%93%E5%9C%B0%E5%9D%80">仓库地址</a></li></ul></div></aside></div>

          <div class="col-main"><article itemscope="" itemtype="http://schema.org/Article">
<div class="js-article-content"><section class="page__comments"><div id="js-gitalk-container"><div class="gt-container"><div class="gt-meta"><span class="gt-counts"><a class="gt-link gt-link-counts">35</a> 条评论</span><div class="gt-user"><div class="gt-user-inner"><span class="gt-user-name">未登录用户</span><span class="gt-ico gt-ico-arrdown"><span class="gt-svg"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="1619"><path d="M511.872 676.8c-0.003 0-0.006 0-0.008 0-9.137 0-17.379-3.829-23.21-9.97l-251.277-265.614c-5.415-5.72-8.743-13.464-8.744-21.984 0-17.678 14.33-32.008 32.008-32.008 9.157 0 17.416 3.845 23.25 10.009l228.045 241.103 228.224-241.088c5.855-6.165 14.113-10.001 23.266-10.001 8.516 0 16.256 3.32 21.998 8.736 12.784 12.145 13.36 32.434 1.264 45.233l-251.52 265.6c-5.844 6.155-14.086 9.984-23.223 9.984-0.025 0-0.051 0-0.076 0z" p-id="1620"></path></svg></span></span></div></div></div><div class=""><div class="gt-header-anon-user-name"><input type="text" placeholder="Anonymous name" class="gt-header-anon-input"></div><div class="gt-header"><a class="gt-avatar-github"><span class="gt-ico gt-ico-github"><span class="gt-svg"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M64 524C64 719.602 189.356 885.926 364.113 947.017 387.65799 953 384 936.115 384 924.767L384 847.107C248.118 863.007 242.674 773.052 233.5 758.001 215 726.501 171.5 718.501 184.5 703.501 215.5 687.501 247 707.501 283.5 761.501 309.956 800.642 361.366 794.075 387.658 787.497 393.403 763.997 405.637 743.042 422.353 726.638 281.774 701.609 223 615.67 223 513.5 223 464.053 239.322 418.406 271.465 381.627 251.142 320.928 273.421 269.19 276.337 261.415 334.458 256.131 394.888 302.993 399.549 306.685 432.663 297.835 470.341 293 512.5 293 554.924 293 592.81 297.896 626.075 306.853 637.426 298.219 693.46 258.054 747.5 262.966 750.382 270.652 772.185 321.292 753.058 381.083 785.516 417.956 802 463.809 802 513.5 802 615.874 742.99 701.953 601.803 726.786 625.381 750.003 640 782.295 640 818.008L640 930.653C640.752 939.626 640 948.664978 655.086 948.665 832.344 888.962 960 721.389 960 524 960 276.576 759.424 76 512 76 264.577 76 64 276.576 64 524Z"></path>
</svg>
</span></span></a><div class="gt-header-comment"><textarea class="gt-header-textarea " placeholder="说点什么" style="overflow-x: hidden; overflow-wrap: break-word; resize: none; height: 71.0833px;"></textarea><div class="gt-header-preview markdown-body hide"></div><div class="gt-header-controls"><a class="gt-header-controls-tip" href="https://guides.github.com/features/mastering-markdown/" target="_blank"><span class="gt-ico gt-ico-tip"><span class="gt-svg"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M512 366.949535c-16.065554 0-29.982212 13.405016-29.982212 29.879884l0 359.070251c0 16.167882 13.405016 29.879884 29.982212 29.879884 15.963226 0 29.879884-13.405016 29.879884-29.879884L541.879884 396.829419C541.879884 380.763865 528.474868 366.949535 512 366.949535L512 366.949535z" p-id="3083"></path>
  <path d="M482.017788 287.645048c0-7.776956 3.274508-15.553912 8.80024-21.181973 5.525732-5.525732 13.302688-8.80024 21.181973-8.80024 7.776956 0 15.553912 3.274508 21.079644 8.80024 5.525732 5.62806 8.80024 13.405016 8.80024 21.181973 0 7.776956-3.274508 15.656241-8.80024 21.181973-5.525732 5.525732-13.405016 8.697911-21.079644 8.697911-7.879285 0-15.656241-3.274508-21.181973-8.697911C485.292295 303.301289 482.017788 295.524333 482.017788 287.645048L482.017788 287.645048z" p-id="3084"></path>
  <path d="M512 946.844409c-239.8577 0-434.895573-195.037873-434.895573-434.895573 0-239.8577 195.037873-434.895573 434.895573-434.895573 239.755371 0 434.895573 195.037873 434.895573 434.895573C946.895573 751.806535 751.755371 946.844409 512 946.844409zM512 126.17088c-212.740682 0-385.880284 173.037274-385.880284 385.777955 0 212.740682 173.037274 385.777955 385.880284 385.777955 212.740682 0 385.777955-173.037274 385.777955-385.777955C897.777955 299.208154 724.740682 126.17088 512 126.17088z" p-id="3085"></path>
</svg>
</span><span class="gt-ico-text">支持 Markdown 语法</span></span></a><button class="gt-btn gt-btn-public"><span class="gt-btn-text">匿名</span></button><button class="gt-btn gt-btn-preview"><span class="gt-btn-text">预览</span></button><button class="gt-btn gt-btn-login"><span class="gt-btn-text">使用 GitHub 登录</span></button></div></div></div></div><div class="gt-comments"><div class="gt-comment "><div class="gt-avatar gt-comment-avatar"><img src="./给gitalk添加匿名评论功能_files/48784911" alt="@bigbyto-anon"></div><div class="gt-comment-content"><div class="gt-comment-header"><div class="gt-comment-block-1"></div><a id="678807036" class="gt-comment-username">匿名</a><span class="gt-comment-text">发表于</span><span class="gt-comment-date">5 个月前</span><a class="gt-comment-reply" title="Reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"></path>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body"><p>test</p></div></div></div><div class="gt-comment "><div class="gt-avatar gt-comment-avatar"><img src="./给gitalk添加匿名评论功能_files/48784911" alt="@bigbyto-anon"></div><div class="gt-comment-content"><div class="gt-comment-header"><div class="gt-comment-block-1"></div><a id="678852709" class="gt-comment-username">匿名</a><span class="gt-comment-text">发表于</span><span class="gt-comment-date">5 个月前</span><a class="gt-comment-reply" title="Reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"></path>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body"><p>xxx</p></div></div></div><div class="gt-comment "><div class="gt-avatar gt-comment-avatar"><img src="./给gitalk添加匿名评论功能_files/48784911" alt="@bigbyto-anon"></div><div class="gt-comment-content"><div class="gt-comment-header"><div class="gt-comment-block-1"></div><a id="679095392" class="gt-comment-username">匿名</a><span class="gt-comment-text">发表于</span><span class="gt-comment-date">5 个月前</span><a class="gt-comment-reply" title="Reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"></path>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body"><p>舌头</p></div></div></div><div class="gt-comment "><div class="gt-avatar gt-comment-avatar"><img src="./给gitalk添加匿名评论功能_files/48784911" alt="@bigbyto-anon"></div><div class="gt-comment-content"><div class="gt-comment-header"><div class="gt-comment-block-1"></div><a id="679456566" class="gt-comment-username">匿名</a><span class="gt-comment-text">发表于</span><span class="gt-comment-date">5 个月前</span><a class="gt-comment-reply" title="Reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"></path>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body"><p>优秀了，原来是这样</p></div></div></div><div class="gt-comment "><div class="gt-avatar gt-comment-avatar"><img src="./给gitalk添加匿名评论功能_files/48784911" alt="@bigbyto-anon"></div><div class="gt-comment-content"><div class="gt-comment-header"><div class="gt-comment-block-1"></div><a id="683392313" class="gt-comment-username">匿名</a><span class="gt-comment-text">发表于</span><span class="gt-comment-date">5 个月前</span><a class="gt-comment-reply" title="Reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"></path>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body">
<p>我觉得好像还可以</p></div></div></div><div class="gt-comment gt-comment-admin"><div class="gt-avatar gt-comment-avatar"><img src="./给gitalk添加匿名评论功能_files/3600657" alt="@xingty"></div><div class="gt-comment-content"><div class="gt-comment-header"><div class="gt-comment-block-1"></div><a id="683392999" class="gt-comment-username" href="https://github.com/xingty">xingty</a><span class="gt-comment-text">发表于</span><span class="gt-comment-date">5 个月前</span><a class="gt-comment-reply" title="Reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"></path>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body"><blockquote>
<p><a href="https://wiyi.org/gitalk-anonymous-comment.html#683392313">at: 匿名</a><br>
我觉得好像还可以</p>
</blockquote>
<p>经历了几个版本的优化已经达到了让我满意的水平。现在匿名支持自定义名称，以及添加评论锚点。还有就是添加评论缓存策略，大大降低了加载时间等。</p></div></div></div><div class="gt-comment "><div class="gt-avatar gt-comment-avatar"><img src="./给gitalk添加匿名评论功能_files/48784911" alt="@bigbyto-anon"></div><div class="gt-comment-content"><div class="gt-comment-header"><div class="gt-comment-block-1"></div><a id="683394271" class="gt-comment-username">匿名</a><span class="gt-comment-text">发表于</span><span class="gt-comment-date">5 个月前</span><a class="gt-comment-reply" title="Reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"></path>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body">
<p>我想配置这个，可是还看不太懂教程</p></div></div></div><div class="gt-comment "><div class="gt-avatar gt-comment-avatar"><img src="./给gitalk添加匿名评论功能_files/48784911" alt="@bigbyto-anon"></div><div class="gt-comment-content"><div class="gt-comment-header"><div class="gt-comment-block-1"></div><a id="683394382" class="gt-comment-username">匿名</a><span class="gt-comment-text">发表于</span><span class="gt-comment-date">5 个月前</span><a class="gt-comment-reply" title="Reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"></path>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body">
<p>现在就只注册了一个新的github账号</p></div></div></div><div class="gt-comment "><div class="gt-avatar gt-comment-avatar"><img src="./给gitalk添加匿名评论功能_files/48784911" alt="@bigbyto-anon"></div><div class="gt-comment-content"><div class="gt-comment-header"><div class="gt-comment-block-1"></div><a id="683394684" class="gt-comment-username">匿名</a><span class="gt-comment-text">发表于</span><span class="gt-comment-date">5 个月前</span><a class="gt-comment-reply" title="Reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"></path>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body">
<p>这些评论最后不是储存在github的issue里面吗</p></div></div></div><div class="gt-comment gt-comment-admin"><div class="gt-avatar gt-comment-avatar"><img src="./给gitalk添加匿名评论功能_files/3600657" alt="@xingty"></div><div class="gt-comment-content"><div class="gt-comment-header"><div class="gt-comment-block-1"></div><a id="683395132" class="gt-comment-username" href="https://github.com/xingty">xingty</a><span class="gt-comment-text">发表于</span><span class="gt-comment-date">5 个月前</span><a class="gt-comment-reply" title="Reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"></path>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body"><blockquote>
<p><a href="https://wiyi.org/gitalk-anonymous-comment.html#683394684">at: 匿名</a><br>
这些评论最后不是储存在github的issue里面吗</p>
</blockquote>
<p>是的，cache是指n-1页评论会永久缓存到访客的localStorage，这个可以大大提高首页的加载时间，缺点就是牺牲了排序功能。因为不缓存每次打开都需要请求github api获取评论，这个过程太慢了，用排序来换加载性能我感觉还是值得的。</p></div></div></div><div class="gt-comment gt-comment-admin"><div class="gt-avatar gt-comment-avatar"><img src="./给gitalk添加匿名评论功能_files/3600657" alt="@xingty"></div><div class="gt-comment-content"><div class="gt-comment-header"><div class="gt-comment-block-1"></div><a id="683395978" class="gt-comment-username" href="https://github.com/xingty">xingty</a><span class="gt-comment-text">发表于</span><span class="gt-comment-date">5 个月前</span><a class="gt-comment-reply" title="Reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"></path>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body"><blockquote>
<p><a href="https://wiyi.org/gitalk-anonymous-comment.html#683394271">at: 匿名</a><br>
我想配置这个，可是还看不太懂教程</p>
</blockquote>
<p>熟悉服务端开发可以自己去写一份实现，这个其实不难。不然只能等我有空把服务端的api整理一下(js并不是我擅长的语言，现在代码很塑料)提交到github会再写一个详细教程该怎么用。 最近比较忙，也太懒了。<g-emoji class="g-emoji" alias="joy" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f602.png">😂</g-emoji></p></div></div></div><div class="gt-comment "><div class="gt-avatar gt-comment-avatar"><img src="./给gitalk添加匿名评论功能_files/48784911" alt="@bigbyto-anon"></div><div class="gt-comment-content"><div class="gt-comment-header"><div class="gt-comment-block-1"></div><a id="683397250" class="gt-comment-username">匿名</a><span class="gt-comment-text">发表于</span><span class="gt-comment-date">5 个月前</span><a class="gt-comment-reply" title="Reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"></path>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body"><blockquote>
<p><a href="https://wiyi.org/gitalk-anonymous-comment.html#683395978">at: xingty</a></p>
<blockquote>
<p><a href="https://wiyi.org/gitalk-anonymous-comment.html#683394271">at: 匿名</a><br>
我想配置这个，可是还看不太懂教程</p>
</blockquote>
<p>熟悉服务端开发可以自己去写一份实现，这个其实不难。不然只能等我有空把服务端的api整理一下(js并不是我擅长的语言，现在代码很塑料)提交到github会再写一个详细教程该怎么用。 最近比较忙，也太懒了。<g-emoji class="g-emoji" alias="joy" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f602.png">😂</g-emoji></p>
</blockquote>
<p>感谢</p></div></div></div><div class="gt-comment "><div class="gt-avatar gt-comment-avatar"><img src="./给gitalk添加匿名评论功能_files/48784911" alt="@bigbyto-anon"></div><div class="gt-comment-content"><div class="gt-comment-header"><div class="gt-comment-block-1"></div><a id="683411310" class="gt-comment-username">匿名</a><span class="gt-comment-text">发表于</span><span class="gt-comment-date">5 个月前</span><a class="gt-comment-reply" title="Reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"></path>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body"><p>fdsf</p></div></div></div><div class="gt-comment "><div class="gt-avatar gt-comment-avatar"><img src="./给gitalk添加匿名评论功能_files/48784911" alt="@bigbyto-anon"></div><div class="gt-comment-content"><div class="gt-comment-header"><div class="gt-comment-block-1"></div><a id="691594361" class="gt-comment-username">匿名</a><span class="gt-comment-text">发表于</span><span class="gt-comment-date">5 个月前</span><a class="gt-comment-reply" title="Reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"></path>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body"><p>Tesf</p></div></div></div><div class="gt-comment "><div class="gt-avatar gt-comment-avatar"><img src="./给gitalk添加匿名评论功能_files/48784911" alt="@bigbyto-anon"></div><div class="gt-comment-content"><div class="gt-comment-header"><div class="gt-comment-block-1"></div><a id="699280277" class="gt-comment-username">匿名</a><span class="gt-comment-text">发表于</span><span class="gt-comment-date">4 个月前</span><a class="gt-comment-reply" title="Reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"></path>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body"><p>test</p></div></div></div><div class="gt-comment "><div class="gt-avatar gt-comment-avatar"><img src="./给gitalk添加匿名评论功能_files/48784911" alt="@bigbyto-anon"></div><div class="gt-comment-content"><div class="gt-comment-header"><div class="gt-comment-block-1"></div><a id="699280318" class="gt-comment-username">hi</a><span class="gt-comment-text">发表于</span><span class="gt-comment-date">4 个月前</span><a class="gt-comment-reply" title="Reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"></path>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body">
<p>hihi</p></div></div></div><div class="gt-comment "><div class="gt-avatar gt-comment-avatar"><img src="./给gitalk添加匿名评论功能_files/48784911" alt="@bigbyto-anon"></div><div class="gt-comment-content"><div class="gt-comment-header"><div class="gt-comment-block-1"></div><a id="703252103" class="gt-comment-username">匿名</a><span class="gt-comment-text">发表于</span><span class="gt-comment-date">4 个月前</span><a class="gt-comment-reply" title="Reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"></path>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body"><p>发发发发</p></div></div></div><div class="gt-comment "><div class="gt-avatar gt-comment-avatar"><img src="./给gitalk添加匿名评论功能_files/48784911" alt="@bigbyto-anon"></div><div class="gt-comment-content"><div class="gt-comment-header"><div class="gt-comment-block-1"></div><a id="723637153" class="gt-comment-username">匿名</a><span class="gt-comment-text">发表于</span><span class="gt-comment-date">3 个月前</span><a class="gt-comment-reply" title="Reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"></path>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body"><p>sadas</p></div></div></div><div class="gt-comment "><div class="gt-avatar gt-comment-avatar"><img src="./给gitalk添加匿名评论功能_files/48784911" alt="@bigbyto-anon"></div><div class="gt-comment-content"><div class="gt-comment-header"><div class="gt-comment-block-1"></div><a id="735562169" class="gt-comment-username">匿名</a><span class="gt-comment-text">发表于</span><span class="gt-comment-date">大约 2 个月前</span><a class="gt-comment-reply" title="Reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"></path>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body"><p>1231231</p></div></div></div><div class="gt-comment "><div class="gt-avatar gt-comment-avatar"><img src="./给gitalk添加匿名评论功能_files/48784911" alt="@bigbyto-anon"></div><div class="gt-comment-content"><div class="gt-comment-header"><div class="gt-comment-block-1"></div><a id="735562292" class="gt-comment-username">匿名</a><span class="gt-comment-text">发表于</span><span class="gt-comment-date">大约 2 个月前</span><a class="gt-comment-reply" title="Reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"></path>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body"><p>顶顶顶发</p></div></div></div><div class="gt-comments-controls"><button class="gt-btn gt-btn-loadmore"><span class="gt-btn-text">加载更多</span></button></div></div></div></div><script>
		window.Lazyload.css('https://bigbyto.gitee.io/assets/js/gitalk/v1.6.8/gitalk.css');
		window.Lazyload.js('https://bigbyto.gitee.io/assets/js/gitalk/v1.6.8/gitalk.min.js', function() {
			var gitalk = new Gitalk({
				clientID: '91931d9090e2710dfe33',
				clientSecret: '42a65f4ce3f11d53b8d82298b1df3ef357ea4467',
				repo: 'gittalk',
				owner: 'AlanLuCN',
				admin: ['AlanLuCN'],
				id: 'test',
				perPage: 20,
				proxy: 'https://github-api.wiyi.org',
				server: {
					oauth_api: 'https://github-api.wiyi.org/api/authorize',
					anonymous_api: 'https://github-api.wiyi.org/api/comment'
				},
				anonymous: {
					accountName: 'bigbyto-anon'
				},
				cache: {
					comments: {
						enable: true,
						ttl: 600
					},
					userInfo: {
						enable: true,
						ttl: 3600
					},
					issue: {
						enable: true,
						ttl: -1
					}
				}
			});
			gitalk.render('js-gitalk-container');
		});
	</script></section></div></article>
          </div></div></div><div class="page__search-panel"><div class="search">
  <div class="main">
    <div class="search-bar">
      <div class="search-box js-search-box">
        <div class="search-box__icon-search"><i class="fas fa-search"></i></div>
        <input type="text">
        <div class="search-box__icon-clear js-icon-clear">
          <a><i class="fas fa-times"></i></a>
        </div>
      </div>
      <button class="button button--secondary button--pill search__cancel js-search-toggle">
        Cancel</button>
    </div>
    <div class="search-result js-search-result"></div>
  </div>
</div>

<script>var SOURCES = window.TEXT_VARIABLES.sources;
var PAHTS = window.TEXT_VARIABLES.paths;
window.Lazyload.js([SOURCES.jquery, PAHTS.search_js], function() {
  var searchData = window.TEXT_SEARCH_DATA ? initData(window.TEXT_SEARCH_DATA) : {};

  function memorize(f) {
    var cache = {};
    return function () {
      var key = Array.prototype.join.call(arguments, ',');
      if (key in cache) return cache[key];
      else return cache[key] = f.apply(this, arguments);
    };
  }

  function initData(data) {
    var _data = [], i, j, key, keys, cur;
    keys = Object.keys(data);
    for (i = 0; i < keys.length; i++) {
      key = keys[i], _data[key] = [];
      for (j = 0; j < data[key].length; j++) {
        cur = data[key][j];
        cur.title = window.decodeUrl(cur.title);
        cur.url = window.decodeUrl(cur.url);
        _data[key].push(cur);
      }
    }
    return _data;
  }

  /// search
  function searchByQuery(query) {
    var i, j, key, keys, cur, _title, result = {};
    keys = Object.keys(searchData);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      for (j = 0; j < searchData[key].length; j++) {
        cur = searchData[key][j], _title = cur.title;
        if ((result[key] === undefined || result[key] && result[key].length < 4 )
          && _title.toLowerCase().indexOf(query.toLowerCase()) >= 0) {
          if (result[key] === undefined) {
            result[key] = [];
          }
          result[key].push(cur);
        }
      }
    }
    return result;
  }

  var renderHeader = memorize(function(header) {
    return $('<p class="search-result__header">' + header + '</p>');
  });

  var renderItem = memorize(function(key, title, url) {
    return $('<li class="search-result__item"><a href="' + url + '">' + title + '</a></li>');
  });

  function render(data) {
    if (!data) {
      return null;
    }
    var $root = $('<ul></ul>'),  i, j, key, keys, cur;
    keys = Object.keys(data);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      $root.append(renderHeader(key));
      for (j = 0; j < data[key].length; j++) {
        cur = data[key][j];
        $root.append(renderItem(cur.key, cur.title, cur.url));
      }
    }
    return $root;
  }

  // search box
  var $searchBox = $('.js-search-box');
  var $searchInput = $searchBox.children('input');
  var $searchClear = $searchBox.children('.js-icon-clear');
  var $result = $('.js-search-result');

  function searchBoxEmpty() {
    $searchBox.removeClass('not-empty'); $result.html(null);
  }

  $searchInput.on('input', window.throttle(function() {
    var val = $(this).val();
    if (val === '' || typeof val !== 'string') {
      searchBoxEmpty();
    } else {
      $searchBox.addClass('not-empty'); $result.html(render(searchByQuery(val)));
    }
  }, 400));
  $searchInput.on('focus', function() {
    $(this).addClass('focus');
  });
  $searchInput.on('blur', function() {
    $(this).removeClass('focus');
  });
  $searchClear.on('click', function() {
    $searchInput.val(''); searchBoxEmpty();
  });

  // search panel
  var $pageRoot = $('.js-page-root');
  var $searchToggle = $('.js-search-toggle');
  var showSearch = false;

  function closeSearchPanel() {
    $pageRoot.removeClass('show-search-panel');
    $searchInput[0].blur();
    setTimeout(function() {
      $searchInput.val(''); searchBoxEmpty();
      window.pageAsideAffix && window.pageAsideAffix.refresh();
    }, 400);
  }
  function openSearchPanel() {
    $pageRoot.addClass('show-search-panel');
    $searchInput[0].focus();
  }

  function filter(event) {
    var tagName = event.target.tagName || event.srcElement.tagName;
    return !(tagName === 'INPUT' || tagName === 'SELECT' || tagName === 'TEXTAREA');
  }

  $(document).on('keyup', function(e) {
    if (filter(e)) {
      // 83 'S', 191 '/'
      if (e.which === 83 || e.which === 191) {
        showSearch = true; openSearchPanel();
      }
      // 27 ESC
      if (e.which ===  27) {
        showSearch = false; closeSearchPanel();
      }
    }
  });

  $searchToggle.on('click', function() {
    showSearch = !showSearch;
    showSearch ? openSearchPanel() : closeSearchPanel();
  });
});</script></div><div class="page__footer">
<div class="footer js-page-footer">
  <div class="main"><aside itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bigbyto"><meta itemprop="url" content="/"><meta itemprop="description" content="do more and do batter"><div class="author-links">
  <ul class="menu menu--nowrap menu--center"></ul>
</div>
</aside>
    <footer class="site-info"><p class="menu menu--center">
        <span>© Bigbyto 2018</span>
        <a type="application/rss+xml" href="https://wiyi.org/feed.xml">RSS</a>
      </p>
      <p>Powered by <a title="Jekyll is a simple, blog-aware, static site generator." href="http://jekyllrb.com/">Jekyll</a> &amp; <a title="TeXt is a succinct theme for blogging." href="https://github.com/kitian616/jekyll-TeXt-theme">TeXt Theme</a>.
      </p>
    </footer>
  </div>
</div></div>
    </div>
  </div>
</div>


<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function scrollToAnchor(anchor, duration, callback) {
      var $root = this;
      $root.animate({ scrollTop: $(anchor).position().top }, duration, function() {
        window.history.replaceState(null, '', window.location.href.split('#')[0] + anchor);
        callback && callback();
      });
    }
    $.fn.scrollToAnchor = scrollToAnchor;
  });
})();(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window), $root, $scrollTarget, $scroller, $scroll;
    var rootTop, rootLeft, rootHeight, scrollBottom, rootBottomTop;
    var offsetBottom = 0, disabled = false, scrollTarget = window, scroller = 'html, body', scroll = window.document;
    var hasInit = false, isOverallScroller = true, curState;

    function setOptions(options) {
      var _options = options || {};
      _options.offsetBottom && (offsetBottom = _options.offsetBottom);
      _options.scrollTarget && (scrollTarget = _options.scrollTarget);
      _options.scroller && (scroller = _options.scroller);
      _options.scroll && (scroll = _options.scroll);
      _options.disabled !== undefined && (disabled = _options.disabled);
      $scrollTarget = $(scrollTarget);
      $scroller = $(scroller);
      isOverallScroller = window.isOverallScroller($scrollTarget[0]);
      $scroll = $(scroll);
      calc(true);
    }
    function initData() {
      top();
      rootHeight = $root.outerHeight();
      rootTop = $root.offset().top + (isOverallScroller ? 0 :  $scrollTarget.scrollTop());
      rootLeft = $root.offset().left;
    }
    function calc(needInitData) {
      needInitData && initData();
      scrollBottom = $scroll.outerHeight() - offsetBottom - rootHeight;
      rootBottomTop = scrollBottom - rootTop;
    }
    function top() {
      if (curState !== 'top') {
        $root.removeClass('fixed').css({
          left: 0,
          top: 0
        });
        curState = 'top';
      }
    }
    function fixed() {
      if (curState !== 'fixed') {
        $root.addClass('fixed').css({
          left: rootLeft + 'px',
          top: 0
        });
        curState = 'fixed';
      }
    }
    function bottom() {
      if (curState !== 'bottom') {
        $root.removeClass('fixed').css({
          left: 0,
          top: rootBottomTop + 'px'
        });
        curState = 'bottom';
      }
    }
    function setState() {
      var scrollTop = $scrollTarget.scrollTop();
      if (scrollTop >= rootTop && scrollTop <= scrollBottom) {
        fixed();
      } else if (scrollTop < rootTop) {
        top();
      } else {
        bottom();
      }
    }
    function init() {
      if(!hasInit) {
        var interval, timeout;
        calc(true); setState();
        // run calc every 100 millisecond
        interval = setInterval(function() {
          calc();
        }, 100);
        timeout = setTimeout(function() {
          clearInterval(interval);
        }, 45000);
        window.pageLoad.then(function() {
          setTimeout(function() {
            clearInterval(interval);
            clearTimeout(timeout);
          }, 3000);
        });
        $scrollTarget.on('scroll', function() {
          disabled || setState();
        });
        $window.on('resize', window.throttle(function() {
          disabled || (calc(true), setState());
        }, 100));
        hasInit = true;
      }
    }

    function affix(options) {
      $root = this;
      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions
      };
    }
    $.fn.affix = affix;
  });
})();(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window), $root, $scrollTarget, $scroller, $tocUl = $('<ul class="toc"></ul>'), $tocLi, $headings, $activeLast, $activeCur;
    var selectors = 'h1,h2,h3', container = 'body', scrollTarget = window, scroller = 'html, body', disabled = false;
    var headingsPos, scrolling = false, rendered = false, hasInit = false;
    function setOptions(options) {
      var _options = options || {};
      _options.selectors && (selectors = _options.selectors);
      _options.container && (container = _options.container);
      _options.scrollTarget && (scrollTarget = _options.scrollTarget);
      _options.scroller && (scroller = _options.scroller);
      _options.disabled !== undefined && (disabled = _options.disabled);
      $headings = $(container).find(selectors);
      $scrollTarget = $(scrollTarget);
      $scroller = $(scroller);
      calc();
    }
    function calc() {
      headingsPos = [];
      $headings.each(function() {
        headingsPos.push(Math.floor($(this).position().top));
      });
    }
    function setState(element, disabled) {
      var scrollTop = $scrollTarget.scrollTop(), i;
      if (disabled || !headingsPos || headingsPos.length < 1) { return; }
      if (element) {
        $activeCur = element;
      } else {
        for (i = 0; i < headingsPos.length; i++) {
          if (scrollTop >= headingsPos[i]) {
            $activeCur = $tocLi.eq(i);
          } else {
            $activeCur || ($activeCur = $tocLi.eq(i));
            break;
          }
        }
      }
      $activeLast && $activeLast.removeClass('active');
      ($activeLast = $activeCur).addClass('active');
    }
    function render() {
      if(!rendered) {
        $root.append($tocUl);
        $headings.each(function() {
          var $this = $(this);
          $tocUl.append($('<li></li>').addClass('toc-' + $this.prop('tagName').toLowerCase())
            .append($('<a></a>').text($this.text()).attr('href', '#' + $this.prop('id'))));
        });
        $tocLi = $tocUl.children('li');
        $tocUl.on('click', 'a', function(e) {
          e.preventDefault();
          var $this = $(this);
          scrolling = true;
          setState($this.parent());
          $scroller.scrollToAnchor($this.attr('href'), 400, function() {
            scrolling = false;
          });
        });
      }
      rendered = true;
    }
    function init() {
      var interval, timeout;
      if(!hasInit) {
        render(); calc(); setState(null, scrolling);
        // run calc every 100 millisecond
        interval = setInterval(function() {
          calc();
        }, 100);
        timeout = setTimeout(function() {
          clearInterval(interval);
        }, 45000);
        window.pageLoad.then(function() {
          setTimeout(function() {
            clearInterval(interval);
            clearTimeout(timeout);
          }, 3000);
        });
        $scrollTarget.on('scroll', function() {
          disabled || setState(null, scrolling);
        });
        $window.on('resize', window.throttle(function() {
          if (!disabled) {
            render(); calc(); setState(null, scrolling);
          }
        }, 100));
      }
      hasInit = true;
    }
    function toc(options) {
      $root = this;
      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions
      };
    }
    toc.setOptions = setOptions;
    $.fn.toc = toc;
  });
})();/*(function () {

})();*/</script><script>
  /* toc must before affix, since affix need to konw toc' height. */(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  var TOC_SELECTOR = window.TEXT_VARIABLES.site.toc.selectors;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window);
    var $articleContent = $('.js-article-content');
    var $tocRoot = $('.js-toc-root'), $col2 = $('.js-col-aside');
    var toc;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
    var hasToc = $articleContent.find(TOC_SELECTOR).length > 0;

    function disabled() {
      return $col2.css('display') === 'none' || !hasToc;
    }

    tocDisabled = disabled();

    toc = $tocRoot.toc({
      selectors: TOC_SELECTOR,
      container: $articleContent,
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      tocDisabled = disabled();
      toc && toc.setOptions({
        disabled: tocDisabled
      });
    }, 100));

  });
})();(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window), $pageFooter = $('.js-page-footer');
    var $pageAside = $('.js-page-aside');
    var affix;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');

    affix = $pageAside.affix({
      offsetBottom: $pageFooter.outerHeight(),
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      scroll: hasSidebar ? $('.js-page-main').children() : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      affix && affix.setOptions({
        disabled: tocDisabled
      });
    }, 100));
  });
})();</script>	<script>
		var _hmt = _hmt || [];
		(function() {
			var anaUrl = 'https://hm' + '.baidu.com/';
			var anaId = '0d78dd4cc120d3434e5264acef528deb';
			var customUrl = anaUrl + 'hm.js?' + anaId;
			console.log(customUrl)

			var hm = document.createElement("script");
			hm.src = customUrl;
			var s = document.getElementsByTagName("script")[0]; 
			s.parentNode.insertBefore(hm, s);
		})();
	</script>
	
    <div id="extwaiokist" style="display:none" v="imcbc" q="74588763" c="139.8" i="144" u="18.60" s="01202101" d="1" w="false" e="" m="BMe="><div id="extwaiimpotscp" style="display:none" v="imcbc" q="74588763" c="139.8" i="144" u="18.60" s="01202101" d="1" w="false" e="" m="BMe=" vn="3gest"></div></div></div>
    <script>(function () {
  var $root = document.getElementsByClassName('root')[0];
  if (window.hasEvent('touchstart')) {
    $root.dataset.isTouch = true;
    document.addEventListener('touchstart', function(){}, false);
  }
})();</script>
  
</body>
</html>
